<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulación de Dron Biomimético - Alas Batientes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        .simulation-container {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        .controls {
            width: 300px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .canvas-container {
            flex: 1;
            margin-left: 20px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="range"] {
            width: 100%;
        }
        .value-display {
            text-align: center;
            font-size: 14px;
            margin-top: 5px;
        }
        .info-panel {
            margin-top: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            background: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
        }
        .back-link:hover {
            background: #0056b3;
        }
        /* Modern tutorial modal styles */
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 24px;
        }
        .modal-backdrop.open { display: flex; }
        .modal-panel {
            width: 100%;
            max-width: 900px;
            background: linear-gradient(180deg,#ffffff,#fbfbfd);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(10,20,40,0.35);
            overflow: hidden;
            transform: translateY(8px);
            opacity: 0;
            transition: transform .28s cubic-bezier(.2,.9,.2,1), opacity .28s ease;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }
        .modal-backdrop.open .modal-panel { transform: translateY(0); opacity: 1; }
        .modal-header {
            padding: 18px 20px;
            border-bottom: 1px solid rgba(20,30,50,0.04);
            display:flex;align-items:center;justify-content:space-between;gap:12px;
        }
        .modal-title { font-size:18px;font-weight:700;color:#102a43; }
        .modal-body { padding: 18px 20px; overflow:auto; flex:1; }
        .modal-footer { padding: 14px 18px; border-top:1px solid rgba(20,30,50,0.04); display:flex;align-items:center;justify-content:space-between;gap:12px; }
        .tutorial-controls { display:flex;gap:8px;align-items:center; }
        .btn { background:#0b6efd;color:#fff;border:none;padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600 }
        .btn.ghost { background:transparent;color:#0b6efd;border:1px solid rgba(11,110,253,0.12) }
        .btn:focus { outline:2px solid rgba(11,110,253,0.18); outline-offset:2px }
        .tutorial-indicator { font-size:13px;color:#445; }
        .tutorial-progress { height:8px;background:#eef2ff;border-radius:6px;overflow:hidden;flex:1;margin-left:12px;margin-right:12px }
        .tutorial-progress > i { display:block;height:100%;background:linear-gradient(90deg,#7c4dff,#4fc3f7);width:0%;transition:width .32s ease }
        /* Responsive adjustments */
        @media (max-width:700px){ .modal-panel{ max-width: 100%; padding:0; border-radius:10px } .modal-header, .modal-footer { padding:12px } }
    </style>
</head>
<body>
    <div class="container">
        <h1>Simulación de Dron Biomimético - Alas Batientes</h1>
        
        <div class="simulation-container">
            <div class="controls">
                <div class="control-group">
                    <label for="flapFrequency">Frecuencia de Batida (Hz):</label>
                    <input type="range" id="flapFrequency" min="0.5" max="15" step="0.1" value="5">
                    <div class="value-display" id="flapFrequency-value">5 Hz</div>
                </div>
                
                <div class="control-group">
                    <label for="flapAmplitude">Amplitud de Batida (°):</label>
                    <input type="range" id="flapAmplitude" min="10" max="90" value="45">
                    <div class="value-display" id="flapAmplitude-value">45°</div>
                </div>
                
                <div class="control-group">
                    <label for="wingSize">Tamaño de Alas (cm):</label>
                    <input type="range" id="wingSize" min="5" max="20" value="10">
                    <div class="value-display" id="wingSize-value">10 cm</div>
                </div>

                <!-- Velocidad eliminada: se deriva de frecuencia/amplitud/tamaño para el dron -->

                <div class="control-group">
                    <label for="angleOfAttack">Ángulo de Ataque (°):</label>
                    <input type="range" id="angleOfAttack" min="-10" max="20" step="0.1" value="5">
                    <div class="value-display" id="angleOfAttack-value">5.0°</div>
                </div>

                <div class="control-group">
                    <label for="altitude">Altitud (m):</label>
                    <input type="range" id="altitude" min="0" max="12000" step="1" value="500">
                    <div class="value-display" id="altitude-value">500 m</div>
                </div>

                <div class="control-group">
                    <label for="planeMass">Masa del dron (kg):</label>
                    <input type="range" id="planeMass" min="0.1" max="20000" step="0.1" value="1338">
                    <div class="value-display" id="planeMass-value">1338.0 kg</div>
                </div>

                <!-- Área del ala opcional eliminada: se calcula automáticamente para el dron -->



                <div class="control-group">
                    <label for="timeOfDay">Hora del Día (0-24):</label>
                    <input type="range" id="timeOfDay" min="0" max="24" step="0.1" value="12">
                    <div class="value-display" id="timeOfDay-value">12.0</div>
                </div>
                    <div class="control-group">
                        <button id="openTutorial" style="width:100%;padding:10px;border-radius:6px;border:1px solid #ccc;background:#007bff;color:#fff;cursor:pointer;">Abrir Tutorial</button>
                    </div>
                
                <!-- Controles de árboles y modo de rendimiento eliminados (valores por defecto en JS) -->
            </div>
            
            <div class="canvas-container">
                <div id="canvas-parent"></div>
            </div>
        </div>
        
    <!-- Experiments panel removed as requested -->

        <!-- Tutorial modal (modern) -->
        <div id="tutorialModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="tutorialTitle" data-open="false">
            <div class="modal-panel" role="document">
                <div class="modal-header">
                    <div class="modal-title" id="tutorialTitle">Tutorial</div>
                    <div style="display:flex;gap:8px;align-items:center;">
                        <div class="tutorial-indicator" id="tutorialIndicator">Paso 1</div>
                        <button id="tutorialClose" class="btn ghost" aria-label="Cerrar tutorial">Cerrar</button>
                    </div>
                </div>
                <div class="modal-body">
                    <div style="display:flex;gap:16px;align-items:flex-start;flex-wrap:wrap;">
                        <div id="tutorialMedia" style="flex:0 0 280px;max-width:280px;border-radius:8px;overflow:hidden;background:#f6f8fa;display:flex;align-items:center;justify-content:center;padding:8px;">
                            <!-- media (svg/png) injected here -->
                        </div>
                        <div id="tutorialContent" style="flex:1 1 360px;min-width:180px;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="tutorial-controls">
                        <button id="tutorialPrev" class="btn ghost">← Anterior</button>
                        <div class="tutorial-progress" aria-hidden="true"><i id="tutorialProgressBar"></i></div>
                        <button id="tutorialNext" class="btn">Siguiente →</button>
                    </div>
                    <div style="font-size:12px;color:#6b7280">Use ESC para cerrar • Avance con teclado ← →</div>
                </div>
            </div>
        </div>

        <!-- Presentation modal -->
        <div id="presentationModal" role="dialog" aria-modal="true" aria-labelledby="presentationTitle" style="display:none;">
            <div style="background:white;padding:20px;border-radius:8px;max-width:800px;margin:40px auto;box-shadow:0 4px 30px rgba(0,0,0,0.25);">
                <div id="presentationContent" style="max-height:380px;overflow:auto;margin-top:8px;line-height:1.45;color:#222;">
                    <p><strong>v₂ (bajo ala):</strong> 8.3 m/s</p>
                    <p><strong>ΔP (P₂ - P₁):</strong> 301.2 Pa</p>
                    <p><strong>Fuerza estimada (N):</strong> 2.1 N</p>
                    <hr>
                    <p>Esta simulación muestra cómo las alas batientes generan sustentación dinámica mediante el movimiento activo, inspirado en insectos como libélulas y colibríes.</p>
                    <h3>¿Cómo logra volar un avión?</h3>
                    <p>Volar ha sido uno de los sueños más antiguos de la humanidad. Pero ¿cómo puede una máquina de cientos de toneladas, como un avión comercial, levantarse y mantenerse en el aire? La respuesta está en una fuerza invisible pero poderosa: la sustentación.</p>
                    <h4>✈️ ¿Qué es la sustentación?</h4>
                    <p>La sustentación (lift) es una fuerza que actúa perpendicularmente al flujo del aire, generada por la forma del ala, el ángulo de ataque y la velocidad del avión.</p>
                    <h4>Perfil aerodinámico</h4>
                    <p>Las alas tienen una parte superior más curvada que obliga al aire a acelerar y reducir su presión local, creando una diferencia de presiones que genera sustentación.</p>
                    <h4>Bernoulli y conservación de la energía</h4>
                    <p>P + ½ ρ v² + ρ g h = constante. En vuelo nivelado, el término ρ g h se cancela y se obtiene ΔP = ½ ρ (v₂² − v₁²).</p>
                    <h4>Complemento: Tercera Ley de Newton</h4>
                    <p>El ala desvía aire hacia abajo; por acción y reacción, el aire empuja el ala hacia arriba. Ambas explicaciones son complementarias.</p>
                </div>
                <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px;">
                    <button id="presentationCopy" style="padding:8px 12px;">Copiar</button>
                    <button id="presentationPrint" style="padding:8px 12px;">Imprimir</button>
                    <button id="presentationClose" style="padding:8px 12px;">Cerrar</button>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h4 style="margin-bottom:8px;color:#1b5e20;">Bernoulli / Presión</h4>
            <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <div style="flex:1 1 140px;background:#e3f2fd;padding:8px;border-radius:6px;">
                    <div style="font-size:12px;color:#1565c0;">ρ (densidad)</div>
                    <div id="rho-display" style="font-weight:700;font-size:15px;color:#0d47a1;">1.155 kg/m³</div>
                </div>
                <div style="flex:1 1 140px;background:#fff3e0;padding:8px;border-radius:6px;">
                    <div style="font-size:12px;color:#e65100;">v₁ (sobre ala)</div>
                    <div id="vtop-display" style="font-weight:700;font-size:15px;color:#bf360c;">24.3 m/s</div>
                </div>
                <div style="flex:1 1 140px;background:#e8f5e9;padding:8px;border-radius:6px;">
                    <div style="font-size:12px;color:#2e7d32;">v₂ (bajo ala)</div>
                    <div id="vbottom-display" style="font-weight:700;font-size:15px;color:#1b5e20;">8.3 m/s</div>
                </div>
                <div style="flex:1 1 160px;background:#f3e5f5;padding:8px;border-radius:6px;">
                    <div style="font-size:12px;color:#6a1b9a;">ΔP (P₂ - P₁)</div>
                    <div id="deltaP-display" style="font-weight:700;font-size:15px;color:#4a148c;">0 Pa</div>
                </div>
                <div style="flex:1 1 160px;background:#fff8e1;padding:8px;border-radius:6px;">
                    <div style="font-size:12px;color:#f57f17;">Fuerza estimada</div>
                    <div id="bernForce-display" style="font-weight:700;font-size:15px;color:#e65100;">0 N</div>
                </div>
            </div>

            <div id="bernoulli-calculations" style="margin-top:12px;background:linear-gradient(180deg,#ffffff,#fafafa);padding:10px;border-radius:8px;border:1px solid #eee;font-size:13px;display:block;">
                <div id="velocity-formula" style="margin-bottom:8px;color:#333;font-family:monospace;background:#f4f6f8;padding:8px;border-radius:4px;"></div>
                <div id="pressure-formula" style="margin-bottom:8px;color:#333;font-family:monospace;background:#f4f6f8;padding:8px;border-radius:4px;"></div>
                <div id="newton-formula" style="margin-bottom:6px;color:#333;font-family:monospace;background:#f4f6f8;padding:8px;border-radius:4px;"></div>
                <div style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                    <div style="flex:1;background:#eceff1;border-radius:6px;height:12px;overflow:hidden;">
                        <div id="pressure-bar" style="height:100%;width:0%;background:linear-gradient(90deg,#42a5f5,#1e88e5);"></div>
                    </div>
                    <div style="font-size:12px;color:#666;">Intensidad ΔP</div>
                </div>
                <!-- Explicación de la fórmula removida por petición del usuario -->
            </div>
            <p><em>Esta simulación muestra cómo las alas batientes generan sustentación dinámica mediante el movimiento activo, inspirado en insectos como libélulas y colibríes.</em></p>
        </div>
        
        <a href="index.html" class="back-link">← Volver al Menú Principal</a>
    </div>

    <script src="drone.js"></script>
</body>
</html>
